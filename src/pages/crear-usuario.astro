---
import "../styles/global.css";
---

<html>
  <head>
    <title>Crear Usuario</title>
  </head>
  <body class="flex items-center justify-center min-h-screen bg-gray-100">
    <form id="formularioUsuario" class="bg-white p-6 rounded shadow-md w-80">
      <label for="uid" class="block text-gray-700">UID:</label>
      <input
        type="text"
        id="uid"
        name="uid"
        readonly
        class="w-full px-3 py-2 border border-gray-300 rounded mb-4 bg-gray-100"
      />

      <label for="nombre" class="block text-gray-700 mb-2">Nombre:</label>
      <input
        type="text"
        id="nombre"
        name="nombre"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded mb-4"
      />

      <button
        type="submit"
        class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600"
      >
        Guardar
      </button>
    </form>

    <script>
      let socket;

      window.addEventListener("DOMContentLoaded", () => {
        const uidInput = document.getElementById("uid");
        socket = new WebSocket("ws://" + window.location.host + "/ws");

        socket.onopen = () => {
          console.log("‚úÖ WebSocket conectado");
        };

        socket.onmessage = (event) => {
          console.log("üì• UID recibido:", event.data);
          uidInput.value = event.data;
        };

        socket.onerror = (error) => {
          console.error("‚ùå Error WebSocket:", error);
        };
      });

      document.getElementById("formularioUsuario").addEventListener("submit", async (event) => {
        event.preventDefault();

        const uid = document.getElementById("uid").value;
        const nombre = document.getElementById("nombre").value;

        if (!uid) {
          alert("‚ö†Ô∏è UID no disponible.");
          return;
        }

        try {
          // Enviar datos al endpoint API
          const response = await fetch("/api/usuarios", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ nombre, uuid: uid }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Error al guardar usuario");
          }

          const data = await response.json();
          console.log("‚úÖ Usuario guardado:", data);
          alert("‚úÖ Usuario guardado correctamente");
          
          // Limpiar el formulario
          document.getElementById("nombre").value = "";
        } catch (error) {
          console.error("‚ùå Error al guardar usuario:", error);
          alert("‚ùå Error: " + error.message);
        }
      });
    </script>
  </body>
</html>